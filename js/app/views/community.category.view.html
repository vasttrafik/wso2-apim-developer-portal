<div class="jumbotron title">
    <div class="container no-padding-left">
        <ol class="breadcrumb">
            <li><a href="#/" target="_self">Hem</a></li>
            <li><a href="#/community" target="_self">Community</a></li>
            <li class="active">{{vm.category.name}}</li>
        </ol>
        <!-- Name -->
        <span class="pull-right pointer margin-right-mini" ng-if="vm.category.createdBy.id && vm.category.createdBy.id === vm.communityService.getMemberId() || vm.communityService.isAdmin()" ng-click="vm.addCategoryUpdate()"><i class="fa fa-pencil-square-o" id="com-edit-category"></i></span>

        <h1 ng-if="!vm.toggleCategoryUpdate" id="category-display-name">{{vm.category.name}}</h1>

        <div ng-show="vm.toggleCategoryUpdate">
            <form name="updateCategoryForm" ng-submit="vm.updateCategory()" role="form">
                <div class="form-group" ng-class="{ 'has-error': updateCategoryForm.name.$dirty && updateCategoryForm.name.$invalid,
  'has-success' : updateCategoryForm.name.$valid}">
                    <input type="text" name="name" id="category-name" class="form-control" ng-model="vm.form.name" maxlength="100" required />
                </div>
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-btn">
              <ui-iconpicker ng-model="vm.form.imageURL" groups="font-awesome"></ui-iconpicker>
            </span>
                        <input class="form-control" type="text" name="imageURL" id="category-imageURL" class="form-control margin-bottom-small" ng-model="vm.form.imageURL" disabled />
                    </div>
                </div>

                <div class="form-actions pull-right">
                    <button type="submit" ng-disabled="updateCategoryForm.$invalid || vm.dataLoadingUpdateCategory" class="btn btn-primary" id="category-submit-button">Uppdatera</button>
                    <span ng-click="vm.toggleCategoryUpdate = false" class="btn btn-link" id="category-discard-button">Ångra</span>
                </div>
            </form>
        </div>
        <!-- End name -->
    </div>
</div>

<div class="container no-padding-top user-input">
    <div class="row color-white" ng-if="!vm.internalCategory">
        <div class="col-md-4 row-xs no-padding-right-lg no-padding-left-lg">
            <div class="col-md-12 com-popular quick-box">
                <div ng-if="vm.labels.popular.id" data-balloon="{{vm.labels.popular.subject}}" data-balloon-pos="up">
                    <h3 class="truncate"><a href="#/community/topic/{{vm.labels.popular.id}}" class="color-white">{{vm.labels.popular.subject}}</a></h3>
                    <p><strong><a href="#/community/forum/{{vm.labels.popular.forumId}}" class="color-white">{{vm.labels.popular.forumName}}</a></strong></p>
                    <p>{{vm.labels.popular.lastPostDate | relativeDate}}</p>

                    <div class="row no-word-wrap hide-xs" style="width: 50%">
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.popular.numberOfPosts}}</h3>
                            <p>Inlägg</p>
                        </div>
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.popular.numberOfAnswers}}</h3>
                            <p>Svar</p>
                        </div>
                        <div class="col-md-2">
                        </div>
                    </div>

                </div>
                <div ng-if="!vm.labels.popular.id">
                    <h3>Det finns inga populära frågor inom denna kategori ännu. <br/><br/>Ställ gärna en!</h3>
                </div>

                <span style="position: absolute;bottom: 5px;right: 10px; font-size: 12px" data-balloon="Populär" data-balloon-pos="up"><a href="{{'#' + vm.locationPath + '/popular'}}" class="color-white">Populär</a></span>
            </div>
        </div>
        <div class="col-md-4 no-padding-right-lg">
            <div class="col-md-12 row-xs com-answered quick-box">
                <div ng-if="vm.labels.answered.id" data-balloon="{{vm.labels.answered.subject}}" data-balloon-pos="up">
                    <h3 class="truncate"><a href="#/community/topic/{{vm.labels.answered.id}}" class="color-white">{{vm.labels.answered.subject}}</a></h3>
                    <p><strong><a href="#/community/forum/{{vm.labels.answered.forumId}}" class="color-white">{{vm.labels.answered.forumName}}</a></strong></p>
                    <p>{{vm.labels.answered.lastPostDate | relativeDate}}</p>

                    <div class="row no-word-wrap hide-xs" style="width: 50%">
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.answered.numberOfPosts}}</h3>
                            <p>Inlägg</p>
                        </div>
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.answered.numberOfAnswers}}</h3>
                            <p>Svar</p>
                        </div>
                        <div class="col-md-2">
                        </div>
                    </div>

                </div>
                <div ng-if="!vm.labels.answered.id">
                    <h3>Inga frågor är ännu besvarade inom denna kategori. <br/><br/>Hjälp gärna till!</h3>
                </div>
                <span style="position: absolute;bottom: 5px;right: 10px; font-size: 12px" data-balloon="Senaste besvarade fråga" data-balloon-pos="up"><a href="{{'#' + vm.locationPath + '/answered'}}" class="color-white">Senast besvarad</a></span>
            </div>
        </div>
        <div class="col-md-4 no-padding-right-lg">
            <div class="col-md-12 row-xs com-unanswered quick-box">
                <div ng-if="vm.labels.unanswered.id" data-balloon="{{vm.labels.unanswered.subject}}" data-balloon-pos="up">
                    <h3 class="truncate"><a href="#/community/topic/{{vm.labels.unanswered.id}}" class="color-white">{{vm.labels.unanswered.subject}}</a></h3>
                    <p><strong><a href="#/community/forum/{{vm.labels.unanswered.forumId}}" class="color-white">{{vm.labels.unanswered.forumName}}</a></strong></p>
                    <p>{{vm.labels.unanswered.lastPostDate | relativeDate}}</p>

                    <div class="row no-word-wrap hide-xs" style="width: 50%">
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.unanswered.numberOfPosts}}</h3>
                            <p>Inlägg</p>
                        </div>
                        <div class="col-md-5 text-center no-padding-top">
                            <h3 class="no-margin-bottom no-margin-top">{{vm.labels.unanswered.numberOfAnswers}}</h3>
                            <p>Svar</p>
                        </div>
                        <div class="col-md-2">
                        </div>
                    </div>

                </div>
                <div ng-if="!vm.labels.unanswered.id">
                    <h3>Det finns inga obesvarade frågor inom denna kategori. <br/><br/>Ställ gärna en ny!</h3>
                </div>
                <span style="position: absolute;bottom: 5px;right: 10px; font-size: 12px" data-balloon="Senaste obesvarade fråga" data-balloon-pos="up"><a href="{{'#' + vm.locationPath + '/unanswered'}}" class="color-white">Senast obesvarad</a></span>
            </div>
        </div>
    </div>

    <div class="row">
        <table class="table table-borderless">
            <thead class="table-header">
                <tr>
                    <th colspan="3">
                        <h1>Forum</h1></th>
                </tr>
            </thead>
            <tbody>
                <tr dir-paginate="entries in vm.category.forums | orderBy:'id' | itemsPerPage: 5">
                    <td style="width: 50px">
                        <div class="area area-small">
                            <span class="{{entries.imageURL}}" aria-hidden="true"></span>
                        </div>
                    </td>
                    <td>
                        <h2 class="no-margin-bottom"><a href="#/community/forum/{{entries.id}}">{{entries.name}}</a></h2>
                        <p>{{entries.description}}</p>
                    </td>
                    <td class="text-center">
                        <h2 class="no-margin-bottom">{{entries.numberOfTopics}}</h2>
                        <p ng-if="entries.numberOfTopics != 1 && !vm.internalCategory">Frågor</p>
                        <p ng-if="entries.numberOfTopics == 1 && !vm.internalCategory">Fråga</p>
                        <p ng-if="entries.numberOfTopics != 1 && vm.internalCategory">Rubriker</p>
                        <p ng-if="entries.numberOfTopics == 1 && vm.internalCategory">Rubrik</p>
                    </td>
                    <td class="text-center">
                        <h2 class="no-margin-bottom">{{entries.numberOfPosts}}</h2>
                        <p>Inlägg</p>
                    </td>
                    <td ng-if="entries.lastPost" class="padding-left-medium pointer" style="width: 40%" ng-click="vm.communityService.redirectToTopic(entries.lastPost.topicId)">
                        <div class="row padding-bottom-mini">
                            <span uib-popover-html="entries.lastPost.createdBy.gravatarProfileInfo.bioHTML + '<b>Community-poäng:</b> ' + entries.lastPost.createdBy.rankings[0].currentPoints" popover-is-open="popoverIsOpen" ng-mouseenter="popoverIsOpen = !popoverIsOpen" ng-mouseleave="popoverIsOpen = !popoverIsOpen"
                                popover-title="{{entries.lastPost.createdBy.gravatarProfileInfo.name}}">
                <span ng-if="!entries.lastPost.createdBy.useGravatar" class="fa-stack">
                            <i class="fa fa-circle fa-stack-2x color-blue"></i>
                            <i class="fa fa-user fa-stack-1x fa-inverse color-white"></i>
                </span>
                            <img ng-if="entries.lastPost.createdBy.useGravatar" src="https://www.gravatar.com/avatar/{{entries.lastPost.createdBy.gravatarEmailHash}}?s=35" class="avatar-small margin-right-mini fa-stack">
                            <span class="signature padding-right-mini">{{entries.lastPost.createdBy.signature}}</span>&bull;
                            </span>
                            <span class="margin-left-mini">{{entries.lastPost.createDate | relativeDate}}</span>

                        </div>
                        <div class="row simple-well margin-bottom-mini" style="font-size: 14px">{{entries.lastPost.text | removeMd | cut:true:140:' ...'}}</div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <dir-pagination-controls></dir-pagination-controls>

    <div class="container padding-bottom-small" ng-show="vm.communityService.isAdmin()" id="com-post-forum">
        <h2>Skapa nytt forum</h2>
        <div class="row well">
            <form name="addForumForm" ng-submit="vm.addForum()" role="form">
                <div class="form-group" ng-class="{ 'has-error': addForumForm.name.$dirty && addForumForm.name.$invalid,
  'has-success' : addForumForm.name.$valid}">
                    <label for="name">Namn</label>
                    <input type="text" name="name" id="forum-name" class="form-control margin-bottom-small" ng-model="vm.form.forum.name" maxlength="100" required />
                    <span ng-show="vm.form.forum.name.length === 100" class="help-block">Maxlängd för ett forum är 100 tecken</span>
                </div>
                <div class="form-group" ng-class="{ 'has-error': addForumForm.description.$dirty && addForumForm.description.$invalid,
  'has-success' : addForumForm.description.$valid}">
                    <label for="description">Beskrivning</label>
                    <input type="text" name="description" id="forum-description" class="form-control margin-bottom-small" ng-model="vm.form.forum.description" maxlength="100" required />
                    <div ng-show="vm.form.forum.description.length === 100" class="help-block">Maxlängd för ett forums beskrivning är 100 tecken</div>
                </div>
                <label for="imageURL">Ikon</label>
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-btn">
                <ui-iconpicker ng-model="iconClass" groups="font-awesome"></ui-iconpicker>
              </span>
                        <input class="form-control" type="text" name="imageURL" id="imageURL" class="form-control margin-bottom-small" ng-model="iconClass" disabled />
                    </div>
                </div>
                <div class="form-actions noclick pull-right">
                    <button type="submit" ng-disabled="addForumForm.$invalid" class="btn btn-primary" id="post-forum-submit-button">Skicka</button>
                    <span ng-click="vm.resetAddForumForm();" class="btn btn-link" id="post-forum-discard-button">Ångra</span>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="container padding-bottom-small" ng-show="user.loggedIn && !vm.communityService.isAdmin()">
    <div class="row">
        <h3><a href="#contact?subject=Förslag på nytt forum" id="com-forum-suggestion-link">Har du förslag på ett nytt forum vi borde skapa?</a></h3>
    </div>
</div>

<div class="container padding-bottom-small" ng-show="user.loggedIn && !vm.communityService.isMember()">
    <div class="row">
        <h3><a href="#/profile" id="com-create-link">Skapa en community profil för att kunna interagera med forumet</a></h3>
    </div>
</div>
